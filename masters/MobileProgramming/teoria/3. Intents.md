# Intents in Android 

Gli Intents sono il modo che hanno le activity di comunicare tra di loro.  
Un Intent è un messaggio astratto che descrive l'azione che si desidera eseguire, non dice esattamente come ottenere quell'azione.  

<br>

Serve per fare un **late runtime binding** tra un componente e un altro.  

_nota:_ un binding è un collegamento tra (una chiamata a una funzione) e (codice specifico che deve essere eseguito), esistono due tipi di binding:
1. Early Binding: Modo classico che corrisponde a:  
    `myObj obj = new myObj(); obj.doSomething();` Il compilatore sa esattamente cosa fare al momento dela compilazione, quale pezzo di codice eseguire, il binding è fatto a tempo di compilazione.  
2. Late Runtime Binding: Il collegamento tra la richiesta e il codice che la esegue non avviene a tempo di compilazione ma avviene a tempo di **esecuzione** (runtime), cioè mentre l'app sta girando sul telefono   

Il meccanismo di late runtime binding è ciò che consente ad Android di essere flessibile e interconnesso, permette alle app di collaborare senza conoscersi.

<br>

**es:** la nostra app crea un itent per 'aprire una pagina web', a nostra app non sa quali browser siano installati e non ne implementa uno.  
Invierà un intent che esprime il voler aprire la pagina web e il sistema a _runtime_ guarderà l'intent - cercherà tra le app installate una in gradi di eseguire quel tipo di richiesta e quando la trova farà il **binding**, la richiesta dell'app viene collegata al codice specifico dell'app che sa aprire pagine web (browser).  

<br>

## Tipi di Intent

Un Intent può essere usato per 3 scopi principali: 
1. Avviare un activity
2. Avviare un Service 
3. Inviare un Broadcast  

E può farlo in due modi:
1. **Intent Esplicito:** L'intent dice al sistema _esattamente_ quale componente vuole avviare  
Activity A manda intent per avviare la Activity B.   

<br>

2. **Intent Implicito:** Dichiariamo l'operazione che vogliammo fare e il sistema troverà l'app migliore per soddisfare questa richiesta (es del browser).  



### Intent Espliciti:  
Gli intent espliciti sono spesso usati per avviare un'altra activity per fargli fare un lavoro e **ricevere un risultato indietro**.  

<center>

![intent esplicito](../../images/explicit_intent_example.png)

</center>


`FirstAct` è in esecuzione (onResume()) e lancia `SecondAct` (tramite un intent).  
SecondAct viene creata (onCreate()) fa il suo lavoro e prima di chiudersi prepara il suo risultato e chiama `finish()`.  
Il sistema distrugge SecondAct riportando in primo piano FirstAct e consegnando il risultato nel metodo di callback `onActivityResult()`.  

<center>

**Codice Intent Esplicito**

</center>

### Lato Sorgente - codice che invia la richiesta

```Java 
Intent i = new Intent(this, SecondAct.class);
i.putExtra('Data', 'stringa passata');
this.startActivityForResult(i,1);
```

(1) Crea un intent esplicito, `this` è il contesto ovvero la activity di partenza (FirstAct).  
SecondAct è la classe esatta dell'activity di destinazione, stiamo dando un indirizzo preciso.   

(2) Aggiungiamo dati extra all'intent (con un Bundle: 'Data' è la chiave 'stringa passata' il valore che inviamo).  

(3) startActivityForResult è il comando chiave, avvia la seconda activity ma si aspetta una risposta, il parametro `i` è l'intent che abbiamo preparato mentre `1` è il requestCode che ci permette di identificare a quale delle nostre richieste si riferisce quello specifico risultato (utile per distinguere risultati quando lanciamo più intent).  


### Codice che riceve la risposta

```Java
@Override
public void onActivityResult(int requestCode, int resultCode, Intent data){
    if (resultCode == RESULT_OK && requestCode == 1){
        data.getExtras().getString('CodRisposta');
    } else if (resultCode != RESULT_OK){
        // activity identificata con request code
        // ha fallito
    }
}
```

(1) è il metodo di callback, `requestCode` è l'ID che avevamo inviato; `resultCode` ci dice se l'operazione è andata a buon fine; `data` è un Intent che arriva da SecondAct contenente i dati della risposta.  



### SecondAct 

```Java
Intent i = getIntet();
String ops = i.getExtra('Data');
// ... procedi con elaborazione ...
```

(1) Recupera l'intent che ha causato l'avvio di questa activity
(2) Estra il valore dal Bundle allegato all'intent usado la chiave corretta (riceve 'stringa passata')   



```Java
@Override
public void finish(){
    Intent i = new Intent();
    i.putExtra('CodRisposta', 'Addio!');
    setResult(RESULT_OK, i);
    super.finish();
}
```

(1) ovverride di finish 
(2) Crea un nuovo intent _vuoto_ che sarà il nostro 'veicolo' per la risposta, non serve specificare il destinatario in quanto il sistema sa già che deve tornare a chi l'ha chiamata  
(3) Allega i dati della  risposta al nuovo intent   
(4) Dice al sistema che l'operazione ha avuto successo 
(5) Chiama il metodo finish originale per chiudere l'activity  

